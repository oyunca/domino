function _slicedToArray(e,n){return _arrayWithHoles(e)||_iterableToArrayLimit(e,n)||_unsupportedIterableToArray(e,n)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,n):void 0}}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=new Array(n);t<n;t++)o[t]=e[t];return o}function _iterableToArrayLimit(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var o,r,a=[],i=!0,l=!1;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(a.push(o.value),!n||a.length!==n);i=!0);}catch(e){l=!0,r=e}finally{try{i||null==t.return||t.return()}finally{if(l)throw r}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}define(["dpz.template","marketconfig/dpz.lang.confirmation"],function(e,n){function i(e){var n=0<arguments.length&&void 0!==e?e:{},t=n.onSubmitResolve,o=n.onSubmitReject,r=n.link,a=n.placeOrderData;Object.assign(m,{onvalidatemerchant:function(e){(function(e){var n=e.link,t=e.appleUrl,o=e.placeOrderData;return jsDPZ.ajax.request({url:jsDPZ.util.htmlUnEncode(n.url),type:n.method,contentType:"application/json",data:JSON.stringify($.extend(!0,{},{orderRequestDto:o},{additionalRequestParams:{domain:window.location.hostname,validationUrl:t},orderRequestDto:{Order:{OrderMethod:"web",SourceOrganizationURI:jsDPZ.config.dataModel.ORDER_REQUEST.SourceOrganizationURI}}}))})})({link:r,appleUrl:e.validationURL,placeOrderData:a}).then(function(e){console.log(e,"onvalidatemerchant"),null!=e&&e.response?m.completeMerchantValidation(e.response):(jsDPZ.topic("validate.wallet.failure").publish({error:new Error("No response body from validate wallet call.")}),null==o||o({reason:"validateWalletResponseFailed"}))}).catch(function(e){jsDPZ.topic("validate.wallet.failure").publish({error:e})})},onpaymentmethodselected:function(e){console.log(e,"onpaymentmethodselected"),m.completePaymentMethodSelection({newTotal:f.total,newLineItem:[]})},onshippingcontactselected:function(e){console.log(e,"onshippingcontactselected"),m.completeShippingContactSelection({newTotal:f.total})},onshippingmethodselected:function(e){console.log(e,"onshippingmethodselected"),m.completeShippingMethodSelection({newTotal:f.total})},onpaymentauthorized:function(e){console.log(e,"onpaymentauthorized"),$.extend(l,e),m.completePayment(g.STATUS_SUCCESS),null==t||t()},oncancel:function(e){$(".js-placeOrder:disabled").prop("disabled",!1),console.log(e,"oncancel"),null==o||o({reason:"applePayCancelled"})}})}var m=null,l={},f={currencyCode:null,countryCode:dpz.market.marketCode,merchantIdentifier:"",merchantCapabilities:[],supportedNetworks:[],shippingType:{Carryout:"storePickup",Delivery:"delivery"}[jsDPZ.app.order.getOrder().data.Details.ServiceMethod],total:{label:e.translate("confirmation.total",null,n),amount:null,type:"final"}},g=window.ApplePaySession,h=function(){for(var e=0;null!=g&&g.supportsVersion(e+1);)e++;return e}(),t=null==g?void 0:g.canMakePayments();return{applePayAvailable:function(e){var n=0<arguments.length&&void 0!==e?e:[];return t&&killConfig.isMarketEnabled("98b601a4-7503-4efc-add4-3e61fffa94b0")&&function(e){var n={amex:1,cartesBancaires:4,chinaUnionPay:1,discover:1,eftpos:4,electron:4,elo:5,interac:1,jcb:2,mada:5,maestro:4,masterCard:1,privateLabel:1,visa:1,vPay:4};return e.map(function(e){return n[e]}).every(function(e){return e<=h})}(n)},renderApplePayButton:function(e){function r(o){function e(e){var n="applepay"===e.currentTarget.dataset.gpmPaymentSubtype,t="radio"===e.currentTarget.type;(n||t)&&($(".js-placeOrder").toggleClass("is-hidden",n),o(n))}return $(".js-paymentType").on("click",e),function(){$(".js-paymentType").off("click",e)}}var n=0<arguments.length&&void 0!==e?e:{},t=n.overrideClickHandler,a=n.buttonType,o=n.currencyCode,i=n.configExtension,l=n.gpmFormPromise,c=n.getTotalAmount,u=i.merchantIdentifier,p=g.canMakePaymentsWithActiveCard(u),s=new Promise(function(t,e){require(["payment.components"],function(e){var n=e.ApplePayButton;t(n)},function(){jsDPZ.topic("apple.pay.button.component.error").publish({error:new Error("requirejs failed to retrieve Apple Pay Button component.")}),e()})}),d=document.querySelector(".js-applePayButtonContainer"),y=t||function(){$.extend(!0,f,i,{currencyCode:o,total:{amount:(null==c?void 0:c())||jsDPZ.app.order.getOrder().data.Details.Amounts.Customer.toString()}}),console.log("call applepaysession constructor"),console.log(h,"apple pay version being used"),console.log(f,"config object for constructor"),m=new g(h,f),$(".js-placeOrder").click()};Promise.all([p,s,l]).then(function(e){var n=_slicedToArray(e,2),t=n[0],o=n[1];t||g.openPaymentSetup&&u&&(y=function(){g.openPaymentSetup(u).then(function(e){}).catch(function(e){})}),preact.render(preact.h(o,{buttonType:a,dpzMarket:dpz.market,showAndHideOnClick:r,clickHandler:y}),d)})},beginPaymentFlow:function(e){var n=0<arguments.length&&void 0!==e?e:{},t=n.onSubmitResolve,o=n.onSubmitReject,r=n.link,a=n.placeOrderData;i({onSubmitResolve:t,onSubmitReject:o,link:r,placeOrderData:a}),console.log("begin()"),m.begin()},getAuthorizedResponse:function(){return l},getApplePayConfig:function(){return f},setApplePayConfig:function(e){return f=e},getApplePaySession:function(){return m},setApplePaySession:function(e){return m=e},getApplePayToken:function(){var e=l.payment,n=(e=void 0===e?{}:e).token;return void 0===n?{}:n}}});