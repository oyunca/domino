define("dpz.easyOrder",["dpz.config","dpz.oauth.constants"],function(e,r){function v(){var e=jsDPZ.app.customer.getCustomer().data;return e.Session.CreateEasyOrder=!1,e.Session.EasyOrderReferrer="",site.sessionTools.save()}var l=e.getMarketProperty,a=r.oauthScopes;return{createEasyOrder:function(p){site.func.getOrderForPowerData().then(function(e){return jsDPZ.ajax.priceOrder({data:e})}).then(function(e){var r,c={order:e.Order},u={Type:"Cash"===p.Payment_Type?"Cash":"CreditCard",Amount:jsDPZ.app.order.getOrder().data.Details.Amounts.Customer};return r=p.Easy_Order_Name?p.Easy_Order_Name:jsDPZ.app.customer.getCustomer().data.Session.EasyOrder?jsDPZ.app.customer.getCustomer().data.Session.EasyOrder.easyOrderNickName:"My Domino's Favorite",c.easyOrder=!0,c.easyOrderNickName=r,$.Deferred(function(r){if("Credit"===p.Payment_Type)if(p.Save_Credit_Card){var e,t=(null===(e=l("payment").creditCard)||void 0===e?void 0:e.expirationFormat)||"M-YYYY",a=/^\w{2}\-\w{2}$/.test(t),s=p.Expiration_Month,o=p.Expiration_Year,i=p.Credit_Card_Number;if(a){var n=dayjs([s,o].join("/"),"M/YY");s=n.format("M"),o=n.format("YYYY"),i=i.replace(/\s/g,"")}jsDPZ.app.customer.getCustomer().saveCreditCard({data:{billingZip:p.Billing_Postal_Code,cardType:p.Credit_Card_Type,expirationMonth:s,expirationYear:o,nickName:p.Credit_Card_Nickname,number:i,securityCode:p.Credit_Card_Security_Code,isDefault:Boolean(p.Is_Default_CC)},success:function(e){$.extend(u,{CardID:e.id,CardType:e.cardType,Expiration:"0".concat(e.expirationMonth).slice(-2)+String(e.expirationYear).substr(2,2),Number:e.lastFour,PostalCode:e.billingZip}),c.order.Payments.push(u),r.resolve(c)},error:function(e){var r=e.responseText.error,t="powerCustomerGenericError";r.length&&"CardOnFileLimitExceeded"===r[0].code&&(t="powerCustomerMaxCreditCards"),site.func.overlayToggle(!0,"codeOverlay",{},{code:t})}})}else{if(0<=p.Credit_Card_Selection){var d=jsDPZ.app.customer.getCustomer().data.CreditCards[p.Credit_Card_Selection];$.extend(u,{CardID:d.id,CardType:d.cardType,Expiration:"0".concat(d.expirationMonth).slice(-2)+String(d.expirationYear).substr(2,2),Number:d.lastFour,PostalCode:d.billingZip})}else $.extend(u,{billingZip:p.Billing_Postal_Code,cardType:p.Credit_Card_Type,expirationMonth:p.Expiration_Month,expirationYear:p.Expiration_Year,nickName:p.Credit_Card_Nickname,number:p.Credit_Card_Number,saveAndPlaceOrder:!1,securityCode:p.Credit_Card_Security_Code,gpmPaymentType:$(".js-paymentType:checked").data("gpm-payment-type")});c.order.Payments.push(u),r.resolve(c)}else c.order.Payments.push(u),r.resolve(c)})}).then(function(e){return function(e){return jsDPZ.ajax.setEasyOrderExpress({data:JSON.stringify(e)})}(e)}).then(function(){return jsDPZ.app.customer.getCustomer().data.Session.createdEasyOrderConfirm=!0,site.sessionTools.save()}).then(function(){jsDPZ.cache.expire("dpz_expire_on_order_and_auth_change_".concat(dpz.market.activeLanguageCode)),window.location.href="/en/"}).catch(function(){site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})})},easyOrderReferrerIsValid:function(e){return"app"===e||"microsite"===e},getHandleOrderThisClick:function(e){var y=e.customerOrders,r=e.easyOrder,h=void 0===r?{}:r,O=e.selector;return function(i){var g=this;i.preventDefault();function n(e){var r=0<arguments.length&&void 0!==e&&e,t=!jsDPZ.util.empty(h),a=t?".js-easyOrderContainer":".js-recentOrders",s=$(a);v();var o,i=$(".js-orderNavBar [aria-selected='true']",O);$(g).hasClass("js-recentOrder")&&(o=i.index(),site.trigger.onEvent({uri:"/home/ROReorder",title:"Recent Order Reorder",group:"Recent Order Reorder",subGroup:"Recent Order Reorder ".concat(o+1)})),$(g).hasClass("js-cta-missing-products")&&site.trigger.onEvent({uri:"/home/eoreorder/discountinuedproduct/additems",title:"Discontinued Product Add Items",group:"Reorder",subGroup:"Discontinued Product Add Items"});var n=jsDPZ.app.customer.getCustomer().data.Session;n.CreateEasyOrder&&(n.CreateEasyOrder=!1,n.EasyOrderReferrer="");var d,c=!1,u=!1,p=!1,l=!1;if(!r){u=$(g).data("product-swapped"),p=$(g).data("missing-products");var f=t?$(".js-easyOrderDetails").attr("data-serviceMethod"):i[0].attributes["data-service-method"].value,C=jsDPZ.app.order.getOrder().data.Details.ServiceMethod,m=!jsDPZ.util.empty(C)&&C!==f;l=!site.isHomepage&&(t||i.length)&&m}u?site.func.overlayToggle(!0,"productSwappedOverlay",{},{onConfirm:function(){site.func.profileReorder(this,h,y)}.bind(g)},function(){$(g).data("missing-products")&&(n.showRemovedProductsOnCheckout=!0,site.sessionTools.save())}):p?(0<$(g).closest(a).length&&(c=!s.find(".js-listOfProducts:visible").children().length),d={allMissing:c,triggers:{load:{}},onConfirm:function(){site.func.profileReorder(this,h,y)}.bind(g),hideAddItems:!0,updatedToppingWeight:$(g).data("updated-topping-weight")},site.func.overlayToggle(!0,"missingProductsOverlay",{},d)):l?site.func.overlayToggle(!0,"serviceMethodSwappedOverlay",{},{onConfirm:function(){site.func.profileReorder(this,h,y)}.bind(g)}):site.func.profileReorder(g,h,y)}try{require(["dpz.orderHistory"],function(e){var a=e.getHasMessage,s=e.renderMessage,o=e.setHasSeenOrderHistoryMessage;o(!1).then(function(){var e=function(r){return function(e){return e.id===r}}(i.currentTarget.dataset.orderid),r=(y.find(e)||{}).order;if(r)if(a(r)){function t(){return n(!0)}s({handleChange:function(){return o().then(t)},order:r})}else n();else n()})})}catch(i){n()}}},handleEasyOrderButtonClick:function(e){e.preventDefault();var r=killConfig.isMarketEnabled("createEasyOrderEnabled"),t=jsDPZ.app.customer.getCustomer().data.Session;if(r&&!$(this).hasClass("saveEasyOrder")){t.CreateEasyOrder=!0,t.EasyOrderReferrer="site";site.sessionTools.save().then(function(){site.func.customerSemiLoggedIn()&&!dpz.oaut.isAuthorized([a.UPDATE_ORDER_HISTORY])()?site.func.showLoginPopup({routeAfter:"".concat(urlConfig.root,"/pages/order/")}):window.location.href="".concat(urlConfig.root,"/pages/order/")})}else site.func.customerSemiLoggedIn()&&!dpz.oaut.isAuthorized([a.UPDATE_ORDER_HISTORY])()?site.func.showLoginPopup({selector:"js-createEasyOrder",setEasyOrder:$(this).attr("data-orderid")}):(site.func.createEasyOrder(),site.func.isHandheld()&&!$(".orderHistoryOrder").is(":visible")&&$(".js-recentOrders .card__title").click())},isInEasyOrderFlow:function(){return killConfig.isMarketEnabled("createEasyOrderEnabled")&&jsDPZ.app.customer.getCustomer().data.Session.CreateEasyOrder},placeInEasyOrderFlow:function(){return jsDPZ.app.customer.getCustomer().data.Session.CreateEasyOrder=!0,site.sessionTools.save()},removeFromEasyOrderFlow:v}});