function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=new Array(r);t<r;t++)o[t]=e[t];return o}function _iterableToArrayLimit(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var o,i,n=[],s=!0,a=!1;try{for(t=t.call(e);!(s=(o=t.next()).done)&&(n.push(o.value),!r||n.length!==r);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==t.return||t.return()}finally{if(a)throw i}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}define("dpz.storeAssistanceModule.methods",["dpz.storeAssistanceModule.constants","dpz.storeAssistanceModule.props","dpz.storeAssistanceModule.state","dpz.storeAssistanceModule.renderer","dpz.storeAssistanceModule.handlers","dpz.config","simplr","dpz.storeLocator"],function(e,r,t,o,i,n,s,a){function d(e){switch(e){case"D":case"H":return j;case"C":case"P":case"T":case"I":return M;case"X":return f;default:return null}}function u(){return jsDPZ.app.customer.getCustomer()}function P(){return jsDPZ.app.store.getStore()}function l(e){return jsDPZ.ajax.storeProfile({StoreID:e}).then(function(e){return jsDPZ.app.store.setStoreFromPower(e),e})}function g(){return!A()&&P().data.AllowDuc&&P().getAvailableServiceMethods().includes("DriveUpCarryout")}function c(e){return _slicedToArray(e,1)[0]}function v(e){var r,t,o,i=e.order,n=e.store;return(null==i?void 0:i.ServiceMethod)===j?(null==i?void 0:null===(r=i.Address)||void 0===r?void 0:r.Street)||(null==i?void 0:null===(t=i.Address)||void 0===t?void 0:t.StreetName)||"":(null==n?void 0:n.storeName)||(null==n?void 0:null===(o=n.address)||void 0===o?void 0:o.Street)||""}function p(e){var r=0<arguments.length&&void 0!==e?e:{},o=r.Address,i=r.StoreID,n=r.ServiceMethod,t=r.isDucOrder,s=void 0!==t&&t,a=D("locations").ignoredAddressFields,d=Object.values(a).reduce(function(e,r){return _objectSpread(_objectSpread({},e),{},_defineProperty({},r,""))},{}),l=u().getSessionData();l.Address=_objectSpread(_objectSpread({},o),d),l.AddressSelection=o.Name||"__OTHER_ADDRESS__",l.ServiceMethod=n,l.StoreID=i,site.storage.save("ServiceType",n),site.sessionTools.save().then(function(){var e=site.func.buildURL({url:"#!/customer/store/update",parameters:{ServiceMethod:n,StoreID:i,Substituted:"false"}});h(e);var r=n===M,t=Boolean(o.Street);r&&t&&T({serviceMethod:n,storeCity:o.City,StoreId:i,storePostalCode:o.PostalCode,storeRegion:o.Region,storeStreet:o.Street,isDucOrder:s}),R()})}function w(e){var r=e.StoreID,t=e.ServiceMethod,v=void 0===t?M:t;return l(r).then(function(e){var r=e.Address,t=r.City,o=r.PostalCode,i=r.Region,n=e.AllowCarryoutOrders,s=e.AllowDeliveryOrders,a=e.AllowHotspotLiteOrders,d=e.AllowPickupWindowOrders,l=e.IsOnlineNow,u=e.StoreID,c=v===f&&g();return c&&(jsDPZ.app.order.getOrder().data=_objectSpread(_objectSpread(_objectSpread({},jsDPZ.app.order.getOrder().data),O),{},{isDucOrder:!0}),site.sessionTools.save()),T({isCarryoutAvailable:n,isDeliveryAvailable:s,isDucAvailable:g(),isHotspotAvailable:a,isOnline:l,isPickupWindowAvailable:d,isDucOrder:c}),p({Address:{City:t,PostalCode:o,Region:i},ServiceMethod:M,isDucOrder:c,StoreID:u})})}function C(){return u().fetchOrderHistory().then(function(e){var r=_(e);if(r.length){var t=H(r);I(t)}})}var M=e.CARRYOUT,j=e.DELIVERY,f=e.DCD,y=e.INACTIVE,A=r.isFutureOrder,S=r.hasServiceMethodSelected,b=r.setIsAutoSet,O=r.sessionOptions,T=t.setState,R=o.renderSam,E=i.getServiceMethodFromOrder,D=n.getMarketProperty,h=s.controller.mRouteAndExecute,m=a.getAddressesWithStore,I=function(s){return l(s.StoreID).then(function(e){var r=e.AllowCarryoutOrders,t=e.AllowDeliveryOrders,o=e.AllowHotspotLiteOrders,i=e.AllowPickupWindowOrders,n=e.IsOnlineNow;return T({customerCity:s.Address.City,customerPostalCode:s.Address.PostalCode,customerRegion:s.Address.Region,customerStreet:s.Address.Street,isCarryoutAvailable:r,isDeliveryAvailable:t,isDucAvailable:g(),isHotspotAvailable:o,isOnline:n,isPickupWindowAvailable:i,serviceMethod:j,StoreId:s.StoreID}),p(s)})},_=function(e){return e.customerOrders.filter(function(e){return"Delivery"===e.order.ServiceMethod})},H=function(e){if(!(e&&0<e.length))return{};var r=function(e){return e.reduce(function(e,r){var t=v(r),o=e[t]||0;return _objectSpread(_objectSpread({},e),{},_defineProperty({},t,o+1))},{})}(e),t=Object.entries(r),o=_slicedToArray(t,1)[0],i=function(r){return function(e){return v(e)===r}}(_slicedToArray(t.reduce(function(e,r){var t=_slicedToArray(r,2),o=t[0],i=t[1],n=e[o];return i<n?e:n===i?[].concat(_toConsumableArray(e),[r]):n<i?[r]:e},[o]).map(c),1)[0]),n=e.find(i).order;return{Address:n.Address,ServiceMethod:n.ServiceMethod,StoreID:n.StoreID}};window.mostPopularAddress=H;function k(){L(u().data.Email)}function N(){return u().fetchOrderHistory().then(function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).customerOrders,r=H(void 0===e?[]:e)||{},t=r.ServiceMethod,o=r.StoreID;return{DOMINANT_SERVICE_METHOD:(void 0===t?"":t)||"",DOMINANT_STORE:{value:void 0===o?"":o}}})}var L=function(e){(D("profile").useCustomerDetailService?jsDPZ.ajax.fetchCustomerDetails:N)({key:e,type:"email"}).then(function(e){var r=e.DOMINANT_SERVICE_METHOD,t=e.DOMINANT_STORE,o="string"==typeof r?r:d(null==r?void 0:r.value);if(!S())return b(!0),Boolean(o)&&o||m().then(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=e.store,t=e.addresses;if(!Boolean(r&&r.AllowDeliveryOrders&&t&&t.length))return T({serviceMethod:"INACTIVE"}),void R();var o=(t||[]).find(function(e){return e.IsDefault})||(t||[]).find();I({Address:o,ServiceMethod:j,StoreID:r.StoreID})}),o===j?C():[M,f].includes(o)&&null!=t&&t.value?w({StoreID:t.value,ServiceMethod:o}):void 0}).catch(function(){T({serviceMethod:y}),jsDPZ.topic("storeAssistanceModule.updated").publish()})};return{getCurrentOrderInfo:function(){var e=jsDPZ.app.order.getOrder().data,r=e.Customer.Address,t=r.City,o=r.PostalCode,i=r.Region,n=r.Street,s=e.Details,a=s.ServiceMethod,d=s.StoreID,l=e.isDucOrder,u=e.isPickupOrder,c=e.lastSelectedStoreLocatorServiceMethodInputValue,v=P().data,p=v.Address,f=p.City,y=p.Region,A=p.Street,S=p.PostalCode,b=v.AllowCarryoutOrders,O=v.AllowDeliveryOrders,D=v.AllowHotspotLiteOrders,h=v.AllowPickupWindowOrders,m=v.IsOnlineNow,I=E({isDucOrder:l,isPickupOrder:u,serviceMethodDetail:a}),_="Hotspots"===c&&a===j;T({isCarryoutAvailable:b,isDeliveryAvailable:O,isDucAvailable:g(),isDucOrder:l,isHotSpot:_,isHotspotAvailable:D,isOnline:m,isPickupOrder:u,isPickupWindowAvailable:h,serviceMethod:I,storeCity:f,storeID:d,storePostalCode:S,storeRegion:y,storeStreet:A}),n&&T({customerCity:t,customerPostalCode:o,customerRegion:i,customerStreet:n}),I?I!==M||A?I!==j||n||(C(),R()):(w({StoreID:d,ServiceMethod:I,isDucOrder:l}),R()):k()},setOrderAddress:p,serviceMethodFromAbbreviation:d,setServiceMethodFromProfileData:L}});